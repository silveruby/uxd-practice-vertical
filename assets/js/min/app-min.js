!function(){var e=angular.module("uxdpv",["firebase"]);e.directive("practiceVerticals",function(){return{restrict:"E",templateUrl:"practiceVerticals.html"}}),e.config(["$locationProvider",function(e){e.html5Mode(!0)}]),e.factory("myFireBase",["$firebaseObject","$firebaseAuth",function(e,s){var t="https://torrid-inferno-2523.firebaseio.com/";return{auth:function(){var e=new Firebase(t);return s(e)},obj:function(s){var a=new Firebase(t+s);return e(a)}}}]),e.controller("mainController",["$scope","$location","$http","myFireBase",function(e,s,t,o){var r=e;r.current_state="",r.current_status="",r.current_link="http://www.uxpvd.io/?email=",r.selected_count=0,r.pv1=[],r.pv2=[],r.select=[],r.msgBox={user:"",email:"",link:"",password:""},r.init=function(){r.loc=s.path("/").search(),void 0!=r.loc.email&&""!=r.loc.email?(r.msgBox.email=r.loc.email,o.obj(r.normalizeEmail(r.msgBox.email)).$loaded().then(function(e){if(null===e.$value)r.msgBox.link=r.current_link+r.loc.email,r.loadDefaultSelection("is_error");else{console.log(e),r.select=e.select,r.msgBox.user=e.name,r.msgBox.link=r.msgBox.link+r.loc.email;for(pv in r.select)for(a in r.select[pv])r.select[pv][a]&&r.selected_count++;r.goToState("s4","is_default")}})["catch"](function(e){r.msgBox.link=r.msgBox.link+r.loc.email,console.log("No record for this userID"),r.loadDefaultSelection("is_error")})):r.loadDefaultSelection("is_default"),r.populatePV()},r.toggleSelected=function(e,s,t){if("s1"==r.current_state||"s2"==r.current_state||"s7"==r.current_state){var a,o,n,l,c,i;a=document.querySelector("."+t.ClassName),i=a.getBoundingClientRect(),o=e.clientX-i.left,n=e.clientY-i.top,l=$("."+t.ClassName+" .ripple").width(),c=$("."+t.ClassName+" .ripple").height(),o-=l/2,n-=c/2,$("."+t.ClassName+" .ripple").css({top:n+"px",left:o+"px"}),$("."+t.ClassName+" .ripple").removeClass("selected").width(),$("."+t.ClassName+" .ripple").addClass("selected"),r.select[s.ClassName][t.ClassName]=!r.select[s.ClassName][t.ClassName],r.select[s.ClassName][t.ClassName]?r.selected_count++:r.selected_count--,"s1"==r.current_state&&r.selected_count>0&&r.goToState("s2","is_default")}},r.createUserLink=function(){r.msgBox.password="password",r.msgBox.email=r.newEmail,r.msgBox.user=r.newName,r.msgBox.link=r.current_link+r.msgBox.email,auth=o.auth(),auth.$createUser({email:r.msgBox.email,password:r.msgBox.password}).then(function(e){console.log("User "+e.uid+" created successfully!"),normalizeEmail=r.normalizeEmail(r.msgBox.email),obj=o.obj(normalizeEmail),userSelectionJSON=r.select,angular.fromJson(angular.toJson(userSelectionJSON)),obj.select=userSelectionJSON,obj.name=r.msgBox.user,obj.$save().then(function(){r.goToState("s3","is_default")},function(e){$(".card-confirmation .error .msg").html("<strong>"+e+"</strong>"),r.goToState("s3","is_error")})})["catch"](function(e){console.log("Error: ",e),$(".card-confirmation .error .msg").html("<strong>"+e+"</strong>"),r.goToState("s3","is_error")})},r.authenticateUser=function(){console.log("User email: "+r.msgBox.email),o.auth().$authWithPassword({email:r.msgBox.email,password:r.userPassword}).then(function(e){r.goToState("s7","is_default")})["catch"](function(e){console.error("Authentication failed:",e),$(".card-authenticate .error .msg").html("<strong>"+e+"</strong>"),r.goToState("s5","is_error")})},r.resetUserPassword=function(){console.log("User password: "+r.msgBox.email),o.auth().$resetPassword({email:r.msgBox.email}).then(function(e){$(".card-reset .success").show(),$(".card-reset .default").hide()})["catch"](function(e){$(".card-reset .error").show(),$(".card-reset .default").hide()})},r.saveChanges=function(){normalizeEmail=r.normalizeEmail(r.msgBox.email),obj=o.obj(normalizeEmail),userSelectionJSON=r.select,angular.fromJson(angular.toJson(userSelectionJSON)),obj.select=userSelectionJSON,obj.name=r.msgBox.user,obj.$save().then(function(){console.log("updated successfully"),r.goToState("s8","is_default")},function(e){r.goToState("s8","is_error")})},r.populatePV=function(){t.get("/./assets/js/uxd-practice-verticals.json").success(function(e){r.pv1=e.slice(0,4),r.pv2=e.slice(4,8)}).error(function(){console.log("Error: cannot get default PVs")})},r.loadDefaultSelection=function(e){t.get("/./assets/js/default-selection.json").success(function(s){r.select=s,r.selected_count=0;for(pv in r.select)for(a in r.select[pv])r.select[pv][a]&&r.selected_count++;r.goToState("s1",e)}).error(function(){console.log("error with default selection"),r.goToState("s1","is_error")})},r.goToState=function(e,s){switch(r.current_state=e,r.current_status=s,console.log("current state: "+r.current_state),console.log("current status: "+r.current_status),$(".fade").removeClass("fadein"),e){case"s1":$(".card-default").addClass("fadein");break;case"s2":$(".card-save").addClass("fadein");break;case"s3":$(".card-confirmation").addClass("fadein");break;case"s4":$(".messageBox .card-user").addClass("fadein");break;case"s5":$(".card-authenticate").addClass("fadein");break;case"s6":$(".card-reset").addClass("fadein");break;case"s7":$(".card-modify").addClass("fadein");break;case"s8":$(".card-updated").addClass("fadein")}},r.normalizeEmail=function(e){return e.replace(/[^a-zA-Z0-9]/g,"-")},r.generatePassword=function(){for(var e=5,s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="",a=0,o=s.length;e>a;++a)t+=s.charAt(Math.floor(Math.random()*o));return t},angular.element(document).ready(function(){r.init()})}])}();